<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conectar WhatsApp - CRM</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/modern-dashboard.css">
    <link rel="stylesheet" href="css/menu-animations.css">
    <link rel="stylesheet" href="css/style.css">
    <style>
        .connection-card {
            max-width: 850px;
            margin: 0 auto;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            background: #fff;
            overflow: hidden;
        }
        
        .connection-header {
            background: #128C7E;
            color: #fff;
            padding: 20px;
            text-align: center;
        }
        
        .connection-header h3 {
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .connection-body {
            padding: 30px;
        }
        
        .nav-pills .nav-link.active {
            background-color: #25D366;
        }
        
        .nav-pills .nav-link {
            color: #075E54;
            border-radius: 30px;
            padding: 10px 25px;
            margin: 0 5px;
            font-weight: 600;
        }
        
        .tab-content {
            padding: 25px 15px;
        }
        
        .step-number {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 30px;
            height: 30px;
            background: #25D366;
            color: white;
            border-radius: 50%;
            margin-right: 10px;
            font-weight: 600;
        }
        
        .step {
            margin-bottom: 25px;
            display: flex;
            align-items: flex-start;
        }
        
        .step-content {
            flex: 1;
        }
        
        .step-title {
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 1.1rem;
        }
        
        .qr-code-container {
            background: #f8f9fa;
            border-radius: 10px;
            border: 1px dashed #dee2e6;
            padding: 20px;
            text-align: center;
            margin: 20px 0;
            height: 300px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .qr-placeholder {
            width: 200px;
            height: 200px;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect x="15" y="15" width="70" height="70" stroke="%23128C7E" stroke-width="3" fill="none" /><rect x="30" y="30" width="40" height="40" stroke="%23128C7E" stroke-width="3" fill="none" /><rect x="40" y="40" width="20" height="20" stroke="%23128C7E" stroke-width="3" fill="none" /></svg>');
            background-size: contain;
            background-repeat: no-repeat;
            margin-bottom: 15px;
        }
        
        .pair-code-container {
            text-align: center;
            margin: 20px 0;
        }
        
        .pair-code-input {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin: 20px 0;
        }
        
        .pair-code-input input {
            width: 50px;
            height: 60px;
            text-align: center;
            font-size: 24px;
            font-weight: 600;
            border: 2px solid #dee2e6;
            border-radius: 8px;
        }
        
        .connection-footer {
            padding: 20px;
            border-top: 1px solid #f0f2f5;
            text-align: center;
        }
        
        .help-text {
            font-size: 0.9rem;
            color: #6c757d;
            margin-top: 20px;
        }
        
        .loading-indicator {
            display: none;
            flex-direction: column;
            align-items: center;
            margin: 20px 0;
        }
        
        .whatsapp-bubble {
            width: 60px;
            height: 60px;
            background: #25D366;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
            box-shadow: 0 4px 10px rgba(37, 211, 102, 0.3);
        }
        
        .whatsapp-bubble i {
            color: white;
            font-size: 2rem;
        }
        
        .spinner-border {
            color: #25D366;
        }
        
        /* Phone SVG */
        .phone-svg {
            max-width: 70%;
            margin: 20px auto;
            display: block;
        }
        
        .connection-tips {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-top: 30px;
        }
        
        .tips-title {
            font-weight: 600;
            margin-bottom: 15px;
            color: #075E54;
        }
        
        .tip-item {
            margin-bottom: 10px;
            display: flex;
            align-items: flex-start;
        }
        
        .tip-item i {
            color: #25D366;
            margin-right: 10px;
            margin-top: 3px;
        }
    </style>
</head>
<body>
    <div class="wrapper">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <a href="index.html" class="sidebar-brand">
                    <i class="fab fa-whatsapp"></i>
                    <span>WhatsApp CRM</span>
                </a>
            </div>
            <nav class="sidebar-menu">
                <h3>Menu Principal</h3>
                <a href="index.html" class="nav-link">
                    <i class="fas fa-home"></i>
                    <span>Dashboard</span>
                </a>
                <a href="#whatsappSubmenu" class="nav-link dropdown-toggle" data-bs-toggle="collapse" aria-expanded="false">
                    <i class="fab fa-whatsapp"></i>
                    <span>WhatsApp</span>
                    <span class="badge bg-primary badge-menu">2</span>
                </a>
                <div class="submenu collapse" id="whatsappSubmenu">
                    <a href="connect-whatsapp.html" class="nav-link">
                        <i class="fas fa-plug"></i>
                        <span>Conectar WhatsApp</span>
                    </a>
                    <a href="whatsapp-sessions.html" class="nav-link">
                        <i class="fas fa-list"></i>
                        <span>Sessões</span>
                    </a>
                </div>
                <a href="conversas.html" class="nav-link">
                    <i class="fas fa-comments"></i>
                    <span>Conversas</span>
                    <span class="badge bg-success badge-menu">5</span>
                </a>
                <a href="kanban.html" class="nav-link">
                    <i class="fas fa-tasks"></i>
                    <span>Funil de Vendas</span>
                </a>
                <a href="quick-messages.html" class="nav-link">
                    <i class="fas fa-bolt"></i>
                    <span>Mensagens Rápidas</span>
                </a>
                <a href="bulk-messages.html" class="nav-link">
                    <i class="fas fa-paper-plane"></i>
                    <span>Disparo em Massa</span>
                </a>
                <a href="extract-contacts.html" class="nav-link">
                    <i class="fas fa-search-plus"></i>
                    <span>Extrair Contatos</span>
                </a>
                <a href="contacts.html" class="nav-link">
                    <i class="fas fa-users"></i>
                    <span>Contatos</span>
                </a>
                <a href="agents.html" class="nav-link">
                    <i class="fas fa-user-tie"></i>
                    <span>Agentes</span>
                </a>
                <h3>Ferramentas</h3>
                <a href="campaigns.html" class="nav-link">
                    <i class="fas fa-bullhorn"></i>
                    <span>Campanhas</span>
                </a>
                <a href="templates.html" class="nav-link">
                    <i class="fas fa-file-alt"></i>
                    <span>Modelos</span>
                </a>
                <a href="import-export.html" class="nav-link">
                    <i class="fas fa-file-import"></i>
                    <span>Importar/Exportar</span>
                </a>
                <h3>Configurações</h3>
                <a href="settings.html" class="nav-link">
                    <i class="fas fa-cog"></i>
                    <span>Configurações</span>
                </a>
                <a href="profile.html" class="nav-link">
                    <i class="fas fa-user"></i>
                    <span>Meu Perfil</span>
                </a>
                <a href="#" class="nav-link" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Sair</span>
                </a>
            </nav>
        </div>

        <!-- Page Content -->
        <div id="content">
            <nav class="top-navbar">
                <button class="menu-toggle" id="sidebarToggle">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="user-menu">
                    <div class="user-info">
                        <p class="user-name">João Silva</p>
                        <p class="user-role">Administrador</p>
                    </div>
                    <div class="user-avatar">
                        <img src="https://ui-avatars.com/api/?name=Joao+Silva&background=25D366&color=fff" alt="User Avatar">
                    </div>
                </div>
            </nav>

            <!-- Main Content -->
            <div class="container-fluid py-4">
                <div class="connection-card mb-4">
                    <div class="connection-header">
                        <h3>Conectar WhatsApp</h3>
                        <p class="mb-0">Adicione sua conta do WhatsApp para começar a gerenciar suas conversas</p>
                    </div>

                    <div class="connection-body">
                        <ul class="nav nav-pills mb-3 justify-content-center" id="connectionTab" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="qr-tab" data-bs-toggle="pill" data-bs-target="#qr-pane" type="button" role="tab" aria-controls="qr-pane" aria-selected="true">
                                    <i class="fas fa-qrcode me-2"></i>Código QR
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="pair-code-tab" data-bs-toggle="pill" data-bs-target="#pair-code-pane" type="button" role="tab" aria-controls="pair-code-pane" aria-selected="false">
                                    <i class="fas fa-mobile-alt me-2"></i>Código de Pareamento
                                </button>
                            </li>
                        </ul>

                        <div class="tab-content" id="connectionTabContent">
                            <!-- QR Code Tab -->
                            <div class="tab-pane fade show active" id="qr-pane" role="tabpanel" aria-labelledby="qr-tab" tabindex="0">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="steps">
                                            <div class="step">
                                                <div class="step-number">1</div>
                                                <div class="step-content">
                                                    <div class="step-title">Abra o WhatsApp no seu telefone</div>
                                                    <p>Acesse o aplicativo do WhatsApp instalado no seu smartphone.</p>
                                                </div>
                                            </div>
                                            <div class="step">
                                                <div class="step-number">2</div>
                                                <div class="step-content">
                                                    <div class="step-title">Acesse o menu de configurações</div>
                                                    <p>Toque nos três pontos (Android) ou na engrenagem (iOS) para acessar as configurações.</p>
                                                </div>
                                            </div>
                                            <div class="step">
                                                <div class="step-number">3</div>
                                                <div class="step-content">
                                                    <div class="step-title">Selecione "Aparelhos conectados"</div>
                                                    <p>Encontre e toque na opção "Aparelhos conectados" ou "WhatsApp Web".</p>
                                                </div>
                                            </div>
                                            <div class="step">
                                                <div class="step-number">4</div>
                                                <div class="step-content">
                                                    <div class="step-title">Escaneie o código QR</div>
                                                    <p>Aponte a câmera do seu telefone para o código QR que aparece ao lado.</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="qr-code-container">
                                            <div class="qr-placeholder" id="qrCode"></div>
                                            <button class="btn btn-primary" id="generateQrBtn">
                                                <i class="fas fa-sync-alt me-2"></i>Gerar Código QR
                                            </button>
                                        </div>
                                        <div class="loading-indicator" id="qrLoadingIndicator">
                                            <div class="whatsapp-bubble">
                                                <i class="fab fa-whatsapp"></i>
                                            </div>
                                            <div class="spinner-border" role="status">
                                                <span class="visually-hidden">Carregando...</span>
                                            </div>
                                            <p class="mt-3">Aguardando conexão...</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Pair Code Tab -->
                            <div class="tab-pane fade" id="pair-code-pane" role="tabpanel" aria-labelledby="pair-code-tab" tabindex="0">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="steps">
                                            <div class="step">
                                                <div class="step-number">1</div>
                                                <div class="step-content">
                                                    <div class="step-title">Abra o WhatsApp no seu telefone</div>
                                                    <p>Acesse o aplicativo do WhatsApp instalado no seu smartphone.</p>
                                                </div>
                                            </div>
                                            <div class="step">
                                                <div class="step-number">2</div>
                                                <div class="step-content">
                                                    <div class="step-title">Acesse o menu de configurações</div>
                                                    <p>Toque nos três pontos (Android) ou na engrenagem (iOS) para acessar as configurações.</p>
                                                </div>
                                            </div>
                                            <div class="step">
                                                <div class="step-number">3</div>
                                                <div class="step-content">
                                                    <div class="step-title">Selecione "Aparelhos conectados"</div>
                                                    <p>Encontre e toque na opção "Aparelhos conectados" ou "WhatsApp Web".</p>
                                                </div>
                                            </div>
                                            <div class="step">
                                                <div class="step-number">4</div>
                                                <div class="step-content">
                                                    <div class="step-title">Toque em "Parear com código"</div>
                                                    <p>Selecione a opção "Parear com código" e será exibido um campo para digitar o código de 8 dígitos.</p>
                                                </div>
                                            </div>
                                            <div class="step">
                                                <div class="step-number">5</div>
                                                <div class="step-content">
                                                    <div class="step-title">Digite o código exibido</div>
                                                    <p>Digite o código de 8 dígitos que aparece ao lado no seu aplicativo WhatsApp.</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="pair-code-container">
                                            <h4>Código de Pareamento</h4>
                                            <p>Use este código para conectar seu WhatsApp sem escanear o QR code.</p>
                                            
                                            <div class="pair-code-input">
                                                <input type="text" maxlength="1" class="form-control digit-input" value="1" readonly>
                                                <input type="text" maxlength="1" class="form-control digit-input" value="2" readonly>
                                                <input type="text" maxlength="1" class="form-control digit-input" value="3" readonly>
                                                <input type="text" maxlength="1" class="form-control digit-input" value="4" readonly>
                                                <input type="text" maxlength="1" class="form-control digit-input" value="5" readonly>
                                                <input type="text" maxlength="1" class="form-control digit-input" value="6" readonly>
                                                <input type="text" maxlength="1" class="form-control digit-input" value="7" readonly>
                                                <input type="text" maxlength="1" class="form-control digit-input" value="8" readonly>
                                            </div>
                                            
                                            <button class="btn btn-primary" id="generatePairCodeBtn">
                                                <i class="fas fa-sync-alt me-2"></i>Gerar Novo Código
                                            </button>
                                            
                                            <p class="help-text mt-3">O código expira em <span id="codeTimer">10:00</span></p>
                                        </div>
                                        
                                        <div class="loading-indicator" id="pairCodeLoadingIndicator">
                                            <div class="whatsapp-bubble">
                                                <i class="fab fa-whatsapp"></i>
                                            </div>
                                            <div class="spinner-border" role="status">
                                                <span class="visually-hidden">Carregando...</span>
                                            </div>
                                            <p class="mt-3">Aguardando conexão...</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Connection Tips -->
                        <div class="connection-tips">
                            <h5 class="tips-title"><i class="fas fa-lightbulb me-2"></i>Dicas de Conexão</h5>
                            <div class="tip-item">
                                <i class="fas fa-check-circle"></i>
                                <div>Certifique-se de que seu telefone tem uma conexão estável com a internet.</div>
                            </div>
                            <div class="tip-item">
                                <i class="fas fa-check-circle"></i>
                                <div>O WhatsApp deve estar atualizado para a versão mais recente.</div>
                            </div>
                            <div class="tip-item">
                                <i class="fas fa-check-circle"></i>
                                <div>Mantenha seu telefone próximo durante o processo de conexão.</div>
                            </div>
                            <div class="tip-item">
                                <i class="fas fa-check-circle"></i>
                                <div>Se estiver tendo problemas, tente recarregar a página ou reiniciar o aplicativo WhatsApp.</div>
                            </div>
                            <div class="tip-item">
                                <i class="fas fa-check-circle"></i>
                                <div>Para usar múltiplas contas, você precisará de diferentes números de telefone.</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="connection-footer">
                        <p class="text-muted mb-0">Após conectar, você poderá enviar e receber mensagens através desta plataforma.</p>
                    </div>
                </div>
                
                <!-- Connected Devices (Preview) -->
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">Dispositivos Conectados</h5>
                        <a href="whatsapp-sessions.html" class="btn btn-sm btn-outline-primary">Ver Todos</a>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Dispositivo</th>
                                        <th>Número</th>
                                        <th>Nome</th>
                                        <th>Status</th>
                                        <th>Última Atividade</th>
                                        <th>Ações</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>
                                            <i class="fab fa-whatsapp fa-lg text-success me-2"></i>
                                            WhatsApp Business
                                        </td>
                                        <td>+55 11 91234-5678</td>
                                        <td>Atendimento</td>
                                        <td><span class="badge bg-success">Online</span></td>
                                        <td>Agora</td>
                                        <td>
                                            <button class="btn btn-sm btn-outline-danger">
                                                <i class="fas fa-sign-out-alt me-1"></i>Desconectar
                                            </button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- jQuery, Popper.js, Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- QR Code Library -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode.js/lib/qrcode.min.js"></script>
    <!-- Custom JS -->
    <script src="js/script.js"></script>
    <script>
        // Toggle sidebar
        $('#sidebarCollapse').on('click', function () {
            $('#sidebar, #content').toggleClass('active');
        });

        // Generate QR Code
        document.getElementById('generateQrBtn').addEventListener('click', function() {
            const qrElement = document.getElementById('qrCode');
            const loadingIndicator = document.getElementById('qrLoadingIndicator');
            const qrContainer = document.querySelector('.qr-code-container');
            
            // Show loading
            qrContainer.style.display = 'none';
            loadingIndicator.style.display = 'flex';
            
            // Simulate loading
            setTimeout(function() {
                loadingIndicator.style.display = 'none';
                qrContainer.style.display = 'flex';
                
                // Generate QR code
                if (typeof QRCode !== 'undefined') {
                    qrElement.innerHTML = '';
                    new QRCode(qrElement, {
                        text: "https://api.whatsapp.com/send?phone=5511912345678",
                        width: 200,
                        height: 200,
                        colorDark: "#128C7E",
                        colorLight: "#ffffff",
                        correctLevel: QRCode.CorrectLevel.H
                    });
                } else {
                    // Fallback if QR Code library not loaded
                    qrElement.innerHTML = 'QR Code would appear here';
                }
            }, 1500);
        });

        // Generate Pair Code
        document.getElementById('generatePairCodeBtn').addEventListener('click', function() {
            const pairCodeContainer = document.querySelector('.pair-code-container');
            const loadingIndicator = document.getElementById('pairCodeLoadingIndicator');
            const digitInputs = document.querySelectorAll('.digit-input');
            
            // Show loading
            pairCodeContainer.style.display = 'none';
            loadingIndicator.style.display = 'flex';
            
            // Simulate loading
            setTimeout(function() {
                loadingIndicator.style.display = 'none';
                pairCodeContainer.style.display = 'block';
                
                // Generate random 8-digit code
                const digits = [];
                for (let i = 0; i < 8; i++) {
                    digits.push(Math.floor(Math.random() * 10));
                }
                
                // Update the input fields
                digitInputs.forEach((input, index) => {
                    input.value = digits[index];
                });
                
                // Start countdown timer
                startTimer(10 * 60); // 10 minutes
            }, 1500);
        });

        // Countdown timer
        function startTimer(duration) {
            let timer = duration;
            const timerElement = document.getElementById('codeTimer');
            const interval = setInterval(function() {
                const minutes = Math.floor(timer / 60);
                const seconds = timer % 60;
                
                timerElement.textContent = 
                    (minutes < 10 ? "0" + minutes : minutes) + ":" + 
                    (seconds < 10 ? "0" + seconds : seconds);
                
                if (--timer < 0) {
                    clearInterval(interval);
                    timerElement.textContent = "Expirado";
                    document.getElementById('generatePairCodeBtn').textContent = "Gerar Novo Código";
                }
            }, 1000);
        }

        // Initialize content
        document.addEventListener('DOMContentLoaded', function() {
            // Auto-generate QR code on page load
            document.getElementById('generateQrBtn').click();
            
            // Start with a static pair code
            startTimer(10 * 60); // 10 minutes
        });
    </script>
    <!-- Bootstrap Bundle JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Menu Manager (se existir) -->
    <script src="js/menu-manager.js"></script>
    <script>
        // Inicialização do menu responsivo (igual index.html)
        document.addEventListener('DOMContentLoaded', function() {
            const sidebarToggle = document.getElementById('sidebarToggle');
            const sidebar = document.querySelector('.sidebar');
            if (sidebarToggle) {
                sidebarToggle.addEventListener('click', function() {
                    document.body.classList.toggle('sidebar-collapsed');
                    localStorage.setItem('sidebarCollapsed', document.body.classList.contains('sidebar-collapsed'));
                });
            }
            if (localStorage.getItem('sidebarCollapsed') === 'true') {
                document.body.classList.add('sidebar-collapsed');
            }
            const dropdownToggles = document.querySelectorAll('.dropdown-toggle');
            dropdownToggles.forEach(toggle => {
                toggle.addEventListener('click', function(e) {
                    e.preventDefault();
                    const submenu = this.nextElementSibling;
                    submenu.classList.toggle('show');
                    this.setAttribute('aria-expanded', 
                        this.getAttribute('aria-expanded') === 'true' ? 'false' : 'true');
                });
            });
        });
    </script>
</body>
</html>
